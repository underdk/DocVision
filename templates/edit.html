{% extends "base.html" %}
{% block title %}DocVision ¬∑ {{ filename }}{% endblock %}

{% block content %}
<section class="panel">
    <div class="panel-header panel-header-row">
        <div>
            <h1 class="panel-title">Review: {{ filename }}</h1>
            <p class="panel-subtitle">
                Preview pages and choose which elements you want to highlight.
            </p>
        </div>
        <div class="panel-nav">
            {% if prev_file %}
                <a href="{{ url_for('edit', filename=prev_file) }}" class="btn-ghost">
                    ‚Üê {{ prev_file }}
                </a>
            {% endif %}
            {% if next_file %}
                <a href="{{ url_for('edit', filename=next_file) }}" class="btn-ghost">
                    {{ next_file }} ‚Üí
                </a>
            {% endif %}
        </div>
    </div>

    <!-- File strip across the top -->
    {% if files %}
    <div class="file-strip file-strip-compact">
        {% for f in files %}
            <a href="{{ url_for('edit', filename=f) }}"
               class="file-pill {% if f == filename %}file-pill-active{% endif %}">
                <span class="file-pill-icon">
                    {% if f.lower().endswith('.pdf') %}
                        üìï
                    {% else %}
                        üñºÔ∏è
                    {% endif %}
                </span>
                <span class="file-pill-name">{{ f }}</span>
            </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Detection options bar (qr / signature / stamp chooser) -->
    <section class="detect-bar">
    <form action="{{ url_for('edit', filename=filename) }}" method="post" class="detect-bar-form">
        <div class="detect-label">Detect:</div>

        <label class="detect-chip">
            <input type="checkbox" name="qr" {% if highlight_qr %}checked{% endif %}>
            <span class="detect-chip-inner">
                <span class="detect-icon">‚ñ¢</span>
                <span class="detect-text-main">QR codes</span>
                <span class="detect-text-sub">Patterns and codes</span>
            </span>
        </label>

        <label class="detect-chip">
            <input type="checkbox" name="signature" {% if highlight_sig %}checked{% endif %}>
            <span class="detect-chip-inner">
                <span class="detect-icon">‚úíÔ∏è</span>
                <span class="detect-text-main">Signatures</span>
                <span class="detect-text-sub">Handwritten marks</span>
            </span>
        </label>

        <label class="detect-chip">
            <input type="checkbox" name="stamp" {% if highlight_stamp %}checked{% endif %}>
            <span class="detect-chip-inner">
                <span class="detect-icon">üî¥</span>
                <span class="detect-text-main">Stamps</span>
                <span class="detect-text-sub">Official seals</span>
            </span>
        </label>

        <div class="detect-actions">
            <button type="button" class="btn-ghost" id="clear-detect">
                Clear
            </button>
            <button type="submit" class="btn-primary">
                Update detection
            </button>
        </div>
    </form>
    </section>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const clearBtn = document.getElementById('clear-detect');
        if (!clearBtn) return;

        clearBtn.addEventListener('click', function () {
            document
                .querySelectorAll('.detect-bar-form input[type="checkbox"]')
                .forEach(cb => cb.checked = false);
        });
    });
    </script>




    <!-- Preview pages -->
    <section class="preview-grid">
        {% for img_data in img_data_list %}
            <div class="preview-card">
                <img src="data:image/png;base64,{{ img_data }}" class="preview-image">
            </div>
        {% endfor %}
    </section>

    

</section>
{% endblock %}
